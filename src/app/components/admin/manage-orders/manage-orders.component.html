<h1 class="text-center"> ALL ORDERS</h1>

<ng-container *ngIf="allOrders$ | async as orders">
  <table mat-table [dataSource]="orders" class="table mat-elevation-z8">
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let order">{{ order.id }}</td>
    </ng-container>

    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef>Date Ordered</th>
      <td mat-cell *matCellDef="let order">{{ order.dateCreated | date: 'medium' }}</td>
    </ng-container>

    <ng-container matColumnDef="customerName">
      <th mat-header-cell *matHeaderCellDef>Customer Name</th>
      <td mat-cell *matCellDef="let order">{{ order.user.firstName}} {{ order.user.lastName}}</td>
    </ng-container>

    <ng-container matColumnDef="orderedBooks">
      <th mat-header-cell *matHeaderCellDef>List of Ordered Books</th>
      <td mat-cell *matCellDef="let order">
        <tr>
          <th>No.</th>
          <th>Book Title</th>
          <th>Quantity</th>
        </tr>
        <tr *ngFor="let book of order.orderBooks; index as i ">
          <td>{{i+1}}</td>
          <td>{{book.book.title}}</td>
          <td>{{book.quantity}}</td>
        </tr>
      </td>
    </ng-container>


    <ng-container matColumnDef="totalAmount">
      <th mat-header-cell *matHeaderCellDef>Total Amount</th>
      <td mat-cell *matCellDef="let order">{{ order.totalAmount | currency : 'EUR' : 'symbol' : '1.2-2' }}</td>
    </ng-container>

    <ng-container matColumnDef="deliveryStatus">
      <th mat-header-cell *matHeaderCellDef>Delivery Status</th>
      <td mat-cell *matCellDef="let order"
        [ngStyle]="{'background-color': order.orderStatus == 'PROCESSING' ? 'blue' :
                                          order.orderStatus == 'SHIPPED' ? 'yellow' :
                                          order.orderStatus == 'CANCELED' ? 'red' :
                                          order.orderStatus == 'DELIVERED' ? 'green' :
                                            'white'}"
      >{{ order.orderStatus }}</td>
    </ng-container>

    <ng-container matColumnDef="recipient">
      <th mat-header-cell *matHeaderCellDef>Recipient name</th>
      <td mat-cell *matCellDef="let order">{{ order.recipientName }}</td>
    </ng-container>
    <ng-container matColumnDef="shippingAddress">
      <th mat-header-cell *matHeaderCellDef>Shipping Address</th>
      <td mat-cell *matCellDef="let order">{{ order.shippingAddress }}</td>
    </ng-container>
    <ng-container matColumnDef="contactNumber">
      <th mat-header-cell *matHeaderCellDef>Contact Number</th>
      <td mat-cell *matCellDef="let order">{{ order.phoneNumber }}</td>
    </ng-container>

    <ng-container matColumnDef="edit">
      <th mat-header-cell *matHeaderCellDef>Edit Order Status</th>
      <td mat-cell *matCellDef="let order"> <button mat-button (click)="updateOrderStatus(order)" [disabled]="disabled(order)">Edit</button></td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['id','date', 'customerName', 'orderedBooks','totalAmount', 'deliveryStatus' , 'recipient' , 'shippingAddress' , 'contactNumber', 'edit']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['id', 'date', 'customerName', 'orderedBooks', 'totalAmount',  'deliveryStatus' , 'recipient' , 'shippingAddress' , 'contactNumber' , 'edit']"></tr>
  </table>

</ng-container>





<!-- TODO:
COlor code each row depending on order status:
green : shipped
gray: cancelled
blue: paid
yellow : in transit

-->
